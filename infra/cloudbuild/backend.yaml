steps:
- id: build-backend
  name: 'gcr.io/cloud-builders/docker'
  args: ['build', '-t', 'gcr.io/fabra-344902/fabra:$COMMIT_SHA', 'backend/']
  waitFor: ['-']

- id: push-backend
  name: 'gcr.io/cloud-builders/docker'
  args: ['push', 'gcr.io/fabra-344902/fabra:$COMMIT_SHA']
  waitFor: ['build-backend']

- id: deploy-backend
  name: 'gcr.io/google.com/cloudsdktool/cloud-sdk'
  entrypoint: gcloud
  args: ['run', 'deploy', 'feedback', '--image', 'gcr.io/fabra-344902/fabra:$COMMIT_SHA', '--region', 'us-west1', '--platform', 'managed']
  waitFor: ['push-backend']
